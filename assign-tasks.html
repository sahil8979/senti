<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carbon Sentinel - Assign Tasks</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .control-disabled {
            background-color: #f3f4f6; /* gray-100 */
            cursor: not-allowed;
            opacity: 0.6;
        }
        .modal-backdrop {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="flex h-screen">
        <!-- Sidebar Navigation -->
        <aside id="sidebar" class="bg-white shadow-lg w-64 flex flex-col">
            <div class="p-6 flex items-center space-x-4 border-b">
                <svg class="h-8 w-8 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75" /></svg>
                <span id="logo-text" class="font-bold text-xl">Carbon Sentinel</span>
            </div>
            <nav class="flex-1 px-4 py-6 space-y-2">
                 <a href="dashboard-manager.html" class="flex items-center p-3 rounded-lg text-gray-600 hover:bg-gray-200">
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" /></svg>
                    <span class="ml-4">Dashboard</span>
                </a>
                <a href="#" class="flex items-center p-3 rounded-lg text-gray-600 hover:bg-gray-200">
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z" /></svg>
                    <span class="ml-4">My Tasks</span>
                </a>
            </nav>
            <div class="px-4 py-6 border-t mt-auto">
                <a href="login.html" class="flex items-center p-3 rounded-lg text-gray-600 hover:bg-gray-200">
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75" /></svg>
                    <span class="ml-4">Logout</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-8 overflow-y-auto bg-white">
            <!-- Header -->
            <div class="flex justify-between items-center pb-6 border-b">
                <div>
                    <p class="text-sm text-gray-500">Batch ID: HRC-2025-09-002 // Phase: Primary Steelmaking</p>
                    <h1 class="text-3xl font-bold text-gray-900">Review & Dispatch Tasks</h1>
                    <p class="text-gray-500 mt-1">Confirm all data entry assignments before notifying your team and activating sensors.</p>
                </div>
                 <div class="flex items-center space-x-4">
                     <div class="flex -space-x-2 overflow-hidden">
                        <img class="inline-block h-9 w-9 rounded-full ring-2 ring-white" src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="User 1">
                    </div>
                    <div>
                        <p class="font-semibold text-sm">John Doe</p>
                        <p class="text-xs text-gray-500">Phase Manager</p>
                    </div>
                </div>
            </div>

            <!-- Task Assignment List -->
            <div class="mt-8 space-y-6">
                <!-- Process Step Group 1: Coke Oven -->
                <div class="bg-gray-50 rounded-xl border border-gray-200">
                    <div class="p-4 border-b">
                        <h2 class="text-xl font-bold text-gray-800">1. Coke Oven</h2>
                    </div>
                    <div class="divide-y divide-gray-200">
                        <div class="p-4 grid grid-cols-12 gap-4 items-center task-row">
                            <div class="col-span-4 font-semibold text-gray-700">Coking Coal Input (tonnes)</div>
                            <div class="col-span-3">
                                <button onclick="openAssigneeModal(this)" class="assignee-button w-full text-sm text-left p-2 border border-gray-300 rounded-md shadow-sm bg-white hover:bg-gray-50 flex justify-between items-center" data-assignee-type="human" data-assignee-name="Amit Kumar">
                                    <span>Amit Kumar</span>
                                    <svg class="w-4 h-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" /></svg>
                                </button>
                            </div>
                            <div class="col-span-3">
                                <div class="file-upload-wrapper">
                                    <input type="file" class="hidden file-input" id="file-upload-1">
                                    <label for="file-upload-1" class="upload-label w-full cursor-pointer bg-white border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm flex items-center justify-center hover:bg-gray-50">
                                        <svg class="w-5 h-5 mr-2 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M15.621 4.379a3 3 0 00-4.242 0l-7 7a3 3 0 004.241 4.243h.001l.497-.5a.75.75 0 011.064 1.057l-.498.501-.002.002a4.5 4.5 0 01-6.364-6.364l7-7a4.5 4.5 0 016.368 6.36l-3.455 3.553A2.625 2.625 0 119.52 9.52l3.45-3.55a.75.75 0 011.061 1.06l-3.45 3.55a1.125 1.125 0 001.59 1.591l3.456-3.554a3 3 0 000-4.242z" clip-rule="evenodd" /></svg>
                                        <span>Upload Template</span>
                                    </label>
                                    <span class="file-name-display text-xs text-gray-500 mt-1"></span>
                                </div>
                            </div>
                            <div class="col-span-2 flex items-center justify-end"><label class="flex items-center"><input type="checkbox" checked class="notify-checkbox h-4 w-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500 mr-2"> Notify</label></div>
                        </div>
                    </div>
                </div>

                <!-- Process Step Group 2: Blast Furnace -->
                <div class="bg-gray-50 rounded-xl border border-gray-200">
                    <div class="p-4 border-b">
                        <h2 class="text-xl font-bold text-gray-800">2. Blast Furnace</h2>
                    </div>
                    <div class="divide-y divide-gray-200">
                        <div class="p-4 grid grid-cols-12 gap-4 items-center task-row">
                            <div class="col-span-4 font-semibold text-gray-700">Natural Gas Consumption (NmÂ³)</div>
                            <div class="col-span-3">
                                <button onclick="openAssigneeModal(this)" class="assignee-button w-full text-sm text-left p-2 border border-gray-300 rounded-md shadow-sm bg-white hover:bg-gray-50 flex justify-between items-center" data-assignee-type="sensor" data-assignee-name="Sensor ID: BF-GAS-001">
                                    <span>Sensor ID: BF-GAS-001</span>
                                    <svg class="w-4 h-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" /></svg>
                                </button>
                            </div>
                            <div class="col-span-3">
                                <div class="file-upload-wrapper">
                                     <input type="file" class="hidden file-input" id="file-upload-2">
                                     <label for="file-upload-2" class="upload-label w-full cursor-pointer bg-white border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm flex items-center justify-center hover:bg-gray-50">
                                        <svg class="w-5 h-5 mr-2 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M15.621 4.379a3 3 0 00-4.242 0l-7 7a3 3 0 004.241 4.243h.001l.497-.5a.75.75 0 011.064 1.057l-.498.501-.002.002a4.5 4.5 0 01-6.364-6.364l7-7a4.5 4.5 0 016.368 6.36l-3.455 3.553A2.625 2.625 0 119.52 9.52l3.45-3.55a.75.75 0 011.061 1.06l-3.45 3.55a1.125 1.125 0 001.59 1.591l3.456-3.554a3 3 0 000-4.242z" clip-rule="evenodd" /></svg>
                                        <span>Upload Template</span>
                                    </label>
                                    <span class="file-name-display text-xs text-gray-500 mt-1"></span>
                                </div>
                            </div>
                            <div class="col-span-2 flex items-center justify-end"><label class="flex items-center"><input type="checkbox" checked class="notify-checkbox h-4 w-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500 mr-2"> Notify</label></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer Actions -->
            <div class="mt-8 pt-6 border-t flex justify-between items-center">
                <a href="phase-workflow-builder.html" class="text-gray-700 font-semibold py-3 px-6 rounded-lg hover:bg-gray-200 flex items-center">
                    <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a.75.75 0 01-.75.75H5.41l2.1 1.95a.75.75 0 11-1.02 1.1l-3.5-3.25a.75.75 0 010-1.1l3.5-3.25a.75.75 0 111.02 1.1l-2.1 1.95h12.59A.75.75 0 0118 10z" clip-rule="evenodd" /></svg>
                    Back to Workflow Builder
                </a>
                <div class="flex items-center gap-4">
                     <a href="view-workflow.html" class="bg-emerald-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-emerald-700">
                        Confirm & Dispatch All Tasks
                    </a>
                </div>
            </div>
        </main>
    </div>

    <!-- Assignee Selection Modal -->
    <div id="assignee-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 modal-backdrop flex items-center justify-center p-4 hidden opacity-0">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md modal-content transform scale-95">
            <div class="p-5 border-b flex justify-between items-center">
                <h2 class="text-xl font-bold text-gray-800">Assign Data Point</h2>
                <button onclick="closeAssigneeModal()" class="text-gray-400 hover:text-gray-600 text-3xl">&times;</button>
            </div>
            <div class="p-5">
                <input type="text" id="search-assignee" placeholder="Search for operator or sensor..." class="w-full border-gray-300 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500">
                <div id="assignee-list" class="mt-4 max-h-80 overflow-y-auto space-y-1">
                    <!-- Dynamic list will be populated here -->
                </div>
            </div>
        </div>
    </div>

<script>
    const modal = document.getElementById('assignee-modal');
    let currentAssigneeButton = null;

    const allAssignees = [
        { name: 'Amit Kumar', type: 'human', role: 'Operator' },
        { name: 'Priya Sharma', type: 'human', role: 'Supervisor' },
        { name: 'Ravi Singh', type: 'human', role: 'Operator' },
        { name: 'Sensor ID: CC-FEED-001', type: 'sensor', role: 'Weighbridge' },
        { name: 'Sensor ID: BF-GAS-001', type: 'sensor', role: 'Gas Flow Meter' },
        { name: 'Sensor ID: BF-TEMP-003', type: 'sensor', role: 'Thermocouple' }
    ];

    function openAssigneeModal(buttonElement) {
        currentAssigneeButton = buttonElement;
        populateAssigneeList('');
        modal.classList.remove('hidden');
        setTimeout(() => {
            modal.classList.remove('opacity-0');
            modal.querySelector('.modal-content').classList.remove('scale-95');
            document.getElementById('search-assignee').focus();
        }, 10);
    }

    function closeAssigneeModal() {
        modal.classList.add('opacity-0');
        modal.querySelector('.modal-content').classList.add('scale-95');
        setTimeout(() => modal.classList.add('hidden'), 300);
    }

    function populateManagerList(searchTerm) {
        const list = document.getElementById('manager-list');
        list.innerHTML = '';
        const lowerSearchTerm = searchTerm.toLowerCase();
        
        const filteredManagers = allManagers.filter(m => m.name.toLowerCase().includes(lowerSearchTerm));

        filteredManagers.forEach(manager => {
            const item = document.createElement('div');
            item.className = 'p-3 hover:bg-gray-100 rounded-md cursor-pointer flex items-center gap-4';
            item.onclick = () => selectManager(manager);
            item.innerHTML = `
                <img class="h-10 w-10 rounded-full" src="${manager.avatar}" alt="${manager.name}">
                <div>
                    <p class="font-semibold text-gray-800">${manager.name}</p>
                    <p class="text-xs text-gray-500">${manager.role}</p>
                </div>
            `;
            list.appendChild(item);
        });
    }

    function selectAssignee(name, type) {
        if (currentAssigneeButton) {
            currentAssigneeButton.querySelector('span').textContent = name;
            currentAssigneeButton.dataset.assigneeName = name;
            currentAssigneeButton.dataset.assigneeType = type;
            handleAssignmentChange(currentAssigneeButton);
        }
        closeAssigneeModal();
    }
    
    function handleAssignmentChange(assigneeElement) {
        const isSensor = assigneeElement.dataset.assigneeType === 'sensor';
        const taskRow = assigneeElement.closest('.task-row');
        const uploadWrapper = taskRow.querySelector('.file-upload-wrapper');
        const notifyCheckbox = taskRow.querySelector('.notify-checkbox');

        const uploadLabel = uploadWrapper.querySelector('.upload-label');
        const fileInput = uploadWrapper.querySelector('.file-input');
        
        if (isSensor) {
            uploadLabel.classList.add('control-disabled');
            fileInput.disabled = true;
            notifyCheckbox.disabled = true;
            notifyCheckbox.checked = false;
        } else {
            uploadLabel.classList.remove('control-disabled');
            fileInput.disabled = false;
            notifyCheckbox.disabled = false;
            notifyCheckbox.checked = true;
        }
    }

    document.getElementById('search-assignee').addEventListener('input', (e) => {
        populateAssigneeList(e.target.value);
    });

    document.querySelectorAll('.file-input').forEach(input => {
        input.addEventListener('change', (e) => {
            const fileNameDisplay = e.target.closest('.file-upload-wrapper').querySelector('.file-name-display');
            if (e.target.files.length > 0) {
                fileNameDisplay.textContent = e.target.files[0].name;
            } else {
                fileNameDisplay.textContent = '';
            }
        });
    });

    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.assignee-button').forEach(handleAssignmentChange);
    });

    window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
            closeAssigneeModal();
        }
    });
</script>
</body>
</html>

